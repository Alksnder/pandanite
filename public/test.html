

<!DOCTYPE html>
<html>
	<head>
    <script src="https://unpkg.com/httprelay@0.0.44/lib/non-mod/httprelay.js" crossorigin></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js" crossorigin></script>
    <script>
      !function(e, t){
        var n = "a.wasm.wasm";
        if(true || !e.WebAssembly){
          n = "a.wasm.js"
        }
        var o = t.createElement("script");
        o.async = !0, o.type = "text/javascript", o.src = n, o.onerror = function(t) {
          console.error("Script Error"), console.error(t), setTimeout(function() {
            e.location.reload(!0)
          }, 3e3)
        };
        var r = t.getElementsByTagName("script")[0];
        r.parentNode.insertBefore(o, r)
      }(window, document);
    </script>
  </head>
	<body>
		<script>
      $(document).ready(()=> {
        setTimeout(function(){
          

          window.getBlockCount = function() {
            let _getBlockCount = Module.cwrap('block_count', 'string', ['array'])
            const encoder = new TextEncoder()
            const view = encoder.encode("")
            return parseInt(_getBlockCount(view))
          }

          window.getTotalWork = function() {
            let _getTotalWork = Module.cwrap('total_work', 'string', ['array'])
            const encoder = new TextEncoder()
            const view = encoder.encode("")
            return _getTotalWork(view)
          }

          window.addPeer = function(peer) {
            let _addPeer = Module.cwrap('add_peer', 'string', ['array'])
            const encoder = new TextEncoder()
            const view = encoder.encode(JSON.stringify(peer))
            return _addPeer(view)
          }

          window.getName = function(peer) {
            let _name = Module.cwrap('name', 'string', ['array'])
            const encoder = new TextEncoder()
            const view = encoder.encode(JSON.stringify(peer))
            return _name(view)
          }

          window.setAddress = function(address) {
            let _set_address = Module.cwrap('set_address', 'string', ['array'])
            const encoder = new TextEncoder()
            const view = encoder.encode(address)
            return _set_address(view)
          }
          // Creating a random name server and get proxy communication method instance
          let proxy = new HttpRelay(new URL('https://demo.httprelay.io')).proxy()

          // Registering Time API endpoint
          proxy.routes.addGet('/block_count', 'block_count', ctx => { 
            return window.getBlockCount();
          });

          proxy.routes.addGet('/name', 'name', ctx => {
            return window.getName();
          });
          
          proxy.routes.addGet('/block', 'block', ctx => {
            
          });
          
          proxy.routes.addGet('/total_work', 'total_work', ctx => {
            return window.getTotalWork();
          });

          proxy.routes.addPost('/add_peer', 'add_peer', ctx => {
            console.log(ctx.request.body.getReader().read().then((value) => {
              console.log(value);
            }));
            return 'ack'
          });
          proxy.routes.addGet('/mine', 'mine', ctx => {});
          proxy.routes.addGet('/gettx', 'gettx', ctx => {});
          proxy.routes.addGet('/v2/mine_status', 'mine_status', ctx => {});
          proxy.routes.addGet('/v2/ledger', 'ledger', ctx => {});
          proxy.routes.addGet('/v2/sync', 'sync', ctx => {});
          proxy.routes.addGet('/v2/block_headers', 'block_headers', ctx => {});
          proxy.routes.addGet('/add_transaction', 'add_transaction', ctx => {});
          proxy.routes.addGet('/synctx', 'synctx', ctx => {});

          proxy.start()
          const nameUrl = proxy.routes.get('name').url().href;
          const url = nameUrl.slice(0, nameUrl.length - 5);
          setTimeout(() => {
            window.setAddress(url);
          }, 5000);

          // window.term.open(document.getElementById('terminal'));
        }, 1000);
      })
		</script>
    <div id="terminal" width="100%" height="100vh"></div>
	</body>
</html>